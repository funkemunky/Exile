package anticheat.checks.other;

import org.bukkit.Material;
import org.bukkit.enchantments.Enchantment;
import org.bukkit.entity.Player;
import org.bukkit.event.Event;
import org.bukkit.event.player.PlayerInteractEvent;
import org.bukkit.inventory.ItemStack;

import anticheat.Exile;
import anticheat.detections.Checks;
import anticheat.detections.ChecksListener;
import anticheat.detections.ChecksType;
import anticheat.user.User;

@ChecksListener(events = { PlayerInteractEvent.class})
public class Exploit extends Checks {

	public Exploit() {
		super("Exploit", ChecksType.OTHER, Exile.getAC(), 1, true, false);
	}

	@SuppressWarnings("deprecation")
	@Override
	protected void onEvent(Event event) {
		if (!this.getState()) {
			return;
		}

		if (event instanceof PlayerInteractEvent) {
			PlayerInteractEvent e = (PlayerInteractEvent) event;
			Player attacker = e.getPlayer();
			if (attacker.isOp()) {
				return;
			}
			ItemStack is = attacker.getItemInHand();
			if (is == null) {
				return;
			}
			if ((is.getType() != Material.BOOK_AND_QUILL) && (is.getType() != Material.WRITTEN_BOOK)) {
				return;
			}
			if (is.getEnchantments().size() > 0) {
				for (Enchantment ench : is.getEnchantments().keySet()) {
					is.removeEnchantment(ench);
				}

				e.setCancelled(true);
				attacker.getInventory().removeItem(new ItemStack[] { is });
				Exile.getAC();
				User user = Exile.getUserManager().getUser(attacker.getUniqueId());
				user.setVL(this, user.getVL(this) + 1);
				this.Alert(attacker, "Book and Quill");
			}
		}
	}

}
